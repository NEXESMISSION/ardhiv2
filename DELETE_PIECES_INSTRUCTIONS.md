# ุชุนูููุงุช ุญุฐู ุงููุทุน ูู ุงูุฏูุนุฉ

## ๐ ููุฎุต ูุง ุณููุนูู SQL Script

ูุฐุง ุงูู SQL script ุณูููู ุจุงูุขุชู:

### โ ูุง ุณูุชู ุญุฐูู:
1. **ุฌููุน ุงููุทุน (land_pieces)** ูู ุฏูุนุฉ "Terrain agricole"
   - ุฌููุน ุงููุทุน 99 ูุทุนุฉ ุณูุชู ุญุฐููุง
   - ุงูุนุฑูุถ ุงููุฑุชุจุทุฉ ุจุงููุทุน (piece-level offers) ุณูุชู ุญุฐููุง ุชููุงุฆูุงู (CASCADE)

### โ ูุง ุณูุชู ุงูุญูุงุธ ุนููู:
1. **ุงูุฏูุนุฉ (land_batches)**
   - ุฏูุนุฉ "Terrain agricole" ุณุชุจูู ููุง ูู
   - ุฌููุน ูุนูููุงุช ุงูุฏูุนุฉ (ุงูุงุณูุ ุงููููุนุ ุงููุณุงุญุฉ ุงูุฅุฌูุงููุฉุ ุงูุชูููุฉุ ุฅูุฎ)

2. **ุงูุนุฑูุถ ุงููุฑุชุจุทุฉ ุจุงูุฏูุนุฉ (batch-level payment_offers)**
   - ุฌููุน ุงูุนุฑูุถ ุงููุฑุชุจุทุฉ ุจุงูุฏูุนุฉ ูุจุงุดุฑุฉ (ูููุณ ุจุงููุทุน) ุณุชุจูู
   - ูุฐู ูู ุงูุนุฑูุถ ุงูุชู ุชู ุฅูุดุงุคูุง ููุฏูุนุฉ ููู

---

## ๐ ุฎุทูุงุช ุงูุชูููุฐ

### ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู ุงููุณุฎุฉ ุงูุจุณูุทุฉ (ููุตู ุจูุง)
1. ุงูุชุญ Supabase SQL Editor
2. ุงูุณุฎ ูุญุชูู ููู `delete_pieces_from_batch_simple.sql`
3. ุงูุตู ูู SQL Editor
4. ุงุถุบุท Run
5. ุจุนุฏ ุงูุชูููุฐุ ูู ุจุชุดุบูู ุงุณุชุนูุงูุงุช ุงูุชุญูู (Verification Queries) ูู ููุณ ุงูููู

### ุงูุทุฑููุฉ 2: ุงุณุชุฎุฏุงู ุงููุณุฎุฉ ุงููุชูุฏูุฉ
1. ุงูุชุญ Supabase SQL Editor
2. ุงูุณุฎ ูุญุชูู ููู `delete_pieces_from_batch.sql`
3. ุงูุตู ูู SQL Editor
4. ุงุถุบุท Run
5. ุณุชุฑู ูุนูููุงุช ูู ุงูู NOTICE ุนู ุนุฏุฏ ุงููุทุน ูุงูุนุฑูุถ

---

## โ๏ธ ุชุญุฐูุฑุงุช ูููุฉ

1. **ูุง ูููู ุงูุชุฑุงุฌุน**: ุจุนุฏ ุญุฐู ุงููุทุนุ ูุง ูููู ุงุณุชุนุงุฏุชูุง ุฅูุง ูู ุฎูุงู backup
2. **ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ**: ุฅุฐุง ูุงูุช ููุงู ูุจูุนุงุช ุฃู ุญุฌูุฒุงุช ูุฑุชุจุทุฉ ุจุงููุทุนุ ูุฏ ุชุญุฏุซ ูุดุงูู
3. **ุงููุณุฎ ุงูุงุญุชูุงุทู**: ูููุตุญ ุจุนูู backup ูุจู ุงูุชูููุฐ

---

## ๐ ุงุณุชุนูุงูุงุช ุงูุชุญูู

ุจุนุฏ ุชูููุฐ ุงูู scriptุ ูู ุจุชุดุบูู ูุฐู ุงูุงุณุชุนูุงูุงุช ููุชุญูู:

### 1. ุงูุชุญูู ูู ุญุฐู ุงููุทุน
```sql
SELECT COUNT(*) as remaining_pieces
FROM land_pieces
WHERE land_batch_id = (
    SELECT id FROM land_batches WHERE name = 'Terrain agricole'
);
-- ูุฌุจ ุฃู ูุนุทู: 0
```

### 2. ุงูุชุญูู ูู ูุฌูุฏ ุงูุฏูุนุฉ
```sql
SELECT id, name, total_surface, total_cost
FROM land_batches
WHERE name = 'Terrain agricole';
-- ูุฌุจ ุฃู ูุนุทู: 1 ุตู
```

### 3. ุงูุชุญูู ูู ุงูุนุฑูุถ ุงููุฑุชุจุทุฉ ุจุงูุฏูุนุฉ
```sql
SELECT COUNT(*) as batch_offers_count
FROM payment_offers
WHERE land_batch_id = (
    SELECT id FROM land_batches WHERE name = 'Terrain agricole'
)
AND land_piece_id IS NULL;
-- ูุฌุจ ุฃู ูุนุทู: ููุณ ุนุฏุฏ ุงูุนุฑูุถ ูุจู ุงูุญุฐู
```

---

## ๐ ูุซุงู ุนูู ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### ูุจู ุงูุชูููุฐ:
- ุนุฏุฏ ุงููุทุน: 99
- ุนุฏุฏ ุงูุนุฑูุถ ุงููุฑุชุจุทุฉ ุจุงูุฏูุนุฉ: (ูุซุงู: 3)
- ุนุฏุฏ ุงูุนุฑูุถ ุงููุฑุชุจุทุฉ ุจุงููุทุน: (ูุซุงู: 0)

### ุจุนุฏ ุงูุชูููุฐ:
- ุนุฏุฏ ุงููุทุน: 0 โ
- ุนุฏุฏ ุงูุนุฑูุถ ุงููุฑุชุจุทุฉ ุจุงูุฏูุนุฉ: 3 โ (ููุณ ุงูุนุฏุฏ)
- ุนุฏุฏ ุงูุนุฑูุถ ุงููุฑุชุจุทุฉ ุจุงููุทุน: 0 โ

---

## ๐ ูู ุญุงูุฉ ุญุฏูุซ ูุดููุฉ

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:

1. **ุชุญูู ูู ุงุณู ุงูุฏูุนุฉ**: ุชุฃูุฏ ุฃู ุงูุงุณู ูุทุงุจู ุชูุงูุงู: `'Terrain agricole'`
2. **ุชุญูู ูู ุงูุตูุงุญูุงุช**: ุชุฃูุฏ ุฃู ูุฏูู ุตูุงุญูุงุช DELETE ุนูู ุงูุฌุฏุงูู
3. **ุชุญูู ูู Foreign Keys**: ุฅุฐุง ูุงูุช ููุงู ูุจูุนุงุช ูุฑุชุจุทุฉุ ูุฏ ุชุญุชุงุฌ ูุญุฐููุง ุฃููุงู

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

- ุงูู script ูุณุชุฎุฏู `BEGIN` ู `COMMIT` ูุถูุงู ุฃู ุงูุนูููุฉ ูููุง ุฃู ูุง ุดูุก (Atomic)
- ุญุฐู ุงููุทุน ุณูุญุฐู ุชููุงุฆูุงู ุงูุนุฑูุถ ุงููุฑุชุจุทุฉ ุจูุง ุจุณุจุจ `ON DELETE CASCADE`
- ุงูุนุฑูุถ ุงููุฑุชุจุทุฉ ุจุงูุฏูุนุฉ (batch-level) ูู ุชุชุฃุซุฑ ูุฃููุง ูุฑุชุจุทุฉ ุจู `land_batch_id` ูููุณ `land_piece_id`

